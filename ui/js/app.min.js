"use strict";angular.module("myApp.services",[]).config(function(){}),angular.module("myApp.services").service("ApiHttpSrv",function(t){var e=function(){return(new Date).getTime()},n=function(e,n,r,o){var i={method:e,url:n,data:r?r:"",cache:!1,headers:o?o:[]};return t(i)},r=function(t,e,r,o,i){o&&(o=angular.isString(o)?o:$.param(o));var a=e+(o?"?"+o:"");return n(t,a,r,i)},o=function(t){return t.status&&t.status>=200&&t.status<=299};return{createHttp:n,createApiHttp:r,getTimestamp:e,isSuccessResponse:o}}),angular.module("myApp.services").service("AuthSrv",function(t,e,n,r,o){var i=null,a=!1,c=!0,c=function(){return!angular.isDefined(localStorage.getItem("user"))&&c},u=function(t){var u=function(n){return"ok"===n[0].status?(i={type:n[0].user_type,token:n[0].token},a=!0,localStorage.setItem("user",t.user),localStorage.setItem("type",i.type),localStorage.setItem("token",i.token),c=!1,e.updateHome=!0,o.redirect("/")):(a=!1,e.loginfail=!0),a},l=function(t){console.log(t),e.disconnect=!0};r.createApiHttp("post",n.getApiUrl("login"),t,t).success(u).error(l)},l=function(){i=null,a=!1,c=!0,localStorage.removeItem("user"),localStorage.removeItem("type"),localStorage.removeItem("token")},s=function(){return a},i=function(){return i},p=function(){if(!a){if(!angular.isDefined(localStorage.getItem("user"))||null==localStorage.getItem("user"))return!1;i={user:localStorage.getItem("user"),type:localStorage.getItem("type"),token:localStorage.getItem("token")},a=!0}return a};return{initialState:c,login:u,logout:l,isLoggedIn:s,currentUser:i,authorized:p}}),angular.module("myApp.services").service("ConfigSrv",function(t){var e=function(t,e){if(!t)throw"ConfigSrv ERROR: "+e},n=function(e){return _keypath(t,e)},r=function(t){var r=n("api.methods."+t);return e(r,"api method "+t+" is not defined in api.methods"),r},o=n("routes"),i=function(t){var e=_.find(o,function(e){var n=new RegExp("^"+e.path+"$"),r=n.test(t);return r});return e};return{getConfig:n,getApiUrl:r,getRouteConfig:i}}),window._keypath=function(t,e){var n,r,o;if(_.isString(e)&&!_.isEmpty(t))return-1===e.indexOf(".")?t[e]||void 0:(o=t,n=e,r=e.split("."),r.forEach(function(t){o&&(o=o[t]||void 0)}),o)},angular.module("myApp.services").service("RedirectSrv",function(t){var e=function(e){t.url(e)};return{redirect:e}}),filters.filter("interpolate",["version",function(t){return function(e){return String(e).replace(/\%VERSION\%/gm,t)}}]),directives.directive("fadeIn",function(){return{compile:function(t){return $(t).css("opacity",0),function(t,e,n){$(e).animate({opacity:1},1e3)}}}}),directives.directive("stopEvent",function(){return{restrict:"A",link:function(t,e,n){e.bind(n.stopEvent,function(t){t.stopPropagation()})}}}),angular.module("myApp.main",[]).controller("mainCtrl",["$scope","$rootScope","$window","ApiHttpSrv","ConfigSrv","$location","AuthSrv","RedirectSrv",function(t,e,n,r,o,i,a,c){e.plant={},a.initialState()||!a.authorized()?i.path("/login"):(e.updateHome=!0,c.redirect("/")),e.logout=function(){a.logout(),e.data=null,e.plantas=null,e.currentId=null,e.plant=null,e.collections={}},e.changePlant=function(t){e.currentId=t,e.plant=e.plantas[t],e.collections={},c.redirect("/")},t.goToContratos=function(){c.redirect("/contratos")},t.goToContratoPage=function(t){c.redirect("/contrato/"+e.plant.id+"/"+t)},t.goToContratistas=function(){c.redirect("/contratistas")},t.goToContratistaPage=function(t){c.redirect("/contratista/"+e.plant.id+"/"+t)},t.goToPersonal=function(){c.redirect("/personal")},t.goToEmpleadoPage=function(t){c.redirect("/empleado/"+e.plant.id+"/"+t)},t.goToMaquinarias=function(){c.redirect("/maquinarias")},t.goToMaquinariaPage=function(t){c.redirect("/maquinaria/"+e.plant.id+"/"+t)},t.goToVehiculos=function(){c.redirect("/vehiculos")},t.goToVehiculoPage=function(t){c.redirect("/vehiculo/"+e.plant.id+"/"+t)},e.goBack=function(){n.history.back()},e.goToHome=function(){c.redirect("/")},t.collapse=function(t){$("#"+t).removeClass("in"),$("#"+t).addClass("collapse")}}]),angular.module("myApp.collections",[]).controller("collectionsCtrl",["$scope","$rootScope","context","$window","$filter","AuthSrv","RedirectSrv","ApiHttpSrv","ConfigSrv",function(t,e,n,r,o,i,a,c,u){(i.initialState()||!i.authorized())&&a.redirect("/login"),e.plant||e.goToHome(),t.pagedItems=[],t.currentPage=0;var l=10,s=n.sortingOrder,p=!1,d=u.getApiUrl(n.type),g=function(){var r={token:i.currentUser().token,idPlanta:e.plant.id};t.loading=!0,c.createApiHttp("get",d,r,r).success(function(r){e.collections[n.type]=r,m(),t.loading=!1,e.updateCollection=!1,t.currentPlantId=e.plant.id}).error(function(e){t.loading=!1})},f=function(t,e){return e?t?-1!==t.toLowerCase().indexOf(e.toLowerCase()):void 0:!0},m=function(r){t.pagedItems=[];var o=e.collections[n.type];r&&(o=t.filteredItems);for(var i=0;i<o.length;i++)i%l===0?t.pagedItems[Math.floor(i/l)]=[o[i]]:t.pagedItems[Math.floor(i/l)].push(o[i])};t.search=function(){t.filteredItems=o("filter")(e.collections[n.type],function(e){for(var n in e)if(f(e[n],t.query))return!0;return!1}),s&&""!==s&&(t.filteredItems=o("orderBy")(t.filteredItems,s,t.reverse)),t.currentPage=0,m(!0)},e.collections[n.type]?m():g(),t.open=function(t){r.open(t,"_blank")},t.range=function(t,e){var n=[];e||(e=t,t=0);for(var r=t;e>r;r++)n.push(r);return n},t.prevPage=function(){t.currentPage>0&&t.currentPage--},t.nextPage=function(){t.currentPage<t.pagedItems.length-1&&t.currentPage++},t.setPage=function(){t.currentPage=this.n},t.sort_by=function(t){s==t&&(p=!p),s=t}}]),angular.module("myApp.entity",[]).controller("entityCtrl",["$scope","$rootScope","$routeParams","context","$window","$filter","AuthSrv","RedirectSrv","ApiHttpSrv","ConfigSrv",function(t,e,n,r,o,i,a,c,u,l){var s=l.getApiUrl(r.type),p=function(){var e={token:a.currentUser().token,idPlanta:n.idP,id:n.id},r=function(e){t.entityData=e[0],t.loading=!1},o=function(e){t.loading=!1};t.loading=!0,u.createApiHttp("post",s,e,e).success(r).error(o)};a.initialState()||!a.authorized()?c.redirect("/login"):p()}]),angular.module("myApp.home",[]).controller("homeCtrl",["$scope","$rootScope","ApiHttpSrv","ConfigSrv","$location","AuthSrv","RedirectSrv",function(t,e,n,r,o,i,a){var c=function(){var o={token:i.currentUser().token},a=function(n){e.data=n[0],e.plantas=e.data.plantas,e.currentId||(e.currentId=0),e.plant=e.data.plantas[e.currentId],e.collections={},t.loading=!1,e.updateHome=!1},c=function(e){t.loading=!1,t.disconnect=!0};t.loading=!0,t.disconnect=!1,n.createApiHttp("post",r.getApiUrl("home"),o,o).success(a).error(c)};(i.initialState()||!i.authorized())&&o.path("/login"),(!e.plant||e.updateHome)&&c(),t.update=function(){c()}}]),angular.module("myApp.login",[]).controller("loginCtrl",["$scope","ApiHttpSrv","ConfigSrv","$rootScope","AuthSrv","$location",function(t,e,n,r,o,i){o.authorized()&&!o.initialState()&&i.path("/home"),r.loginfail=!1,r.disconnect=!1,t.login=function(e){var n={user:t.user.name,pass:t.user.password};o.login(n)}}]);