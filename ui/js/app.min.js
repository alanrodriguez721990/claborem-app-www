"use strict";angular.module("myApp.services",[]).config(function(){}),angular.module("myApp.services").service("ApiHttpSrv",function(e){var t=function(){return(new Date).getTime()},r=function(t,r,n,o){var i={method:t,url:r,data:n?n:"",cache:!1,headers:o?o:[]};return e(i)},n=function(e,t,n,o,i){o&&(o=angular.isString(o)?o:$.param(o));var a=t+(o?"?"+o:"");return r(e,a,n,i)},o=function(e){return e.status&&e.status>=200&&e.status<=299};return{createHttp:r,createApiHttp:n,getTimestamp:t,isSuccessResponse:o}}),angular.module("myApp.services").service("AuthSrv",function(e,t,r,n,o){var i=null,a=!1,c=!0,c=function(){return!angular.isDefined(localStorage.getItem("user"))&&c},s=function(e){var s=function(r){return"ok"===r[0].status?(i={type:r[0].user_type,token:r[0].token},a=!0,localStorage.setItem("user",e.user),localStorage.setItem("type",i.type),localStorage.setItem("token",i.token),c=!1,o.redirect("/")):(a=!1,t.loginfail=!0),a},u=function(e){console.log(e)};n.createApiHttp("post",r.getApiUrl("login"),e,e).success(s).error(u)},u=function(){i=null,a=!1,c=!0,localStorage.removeItem("user"),localStorage.removeItem("type"),localStorage.removeItem("token")},l=function(){return a},i=function(){return i},g=function(){if(!a){if(!angular.isDefined(localStorage.getItem("user"))||null==localStorage.getItem("user"))return!1;i={user:localStorage.getItem("user"),type:localStorage.getItem("type"),token:localStorage.getItem("token")},a=!0}return a};return{initialState:c,login:s,logout:u,isLoggedIn:l,currentUser:i,authorized:g}}),angular.module("myApp.services").service("ConfigSrv",function(e){var t=function(e,t){if(!e)throw"ConfigSrv ERROR: "+t},r=function(t){return _keypath(e,t)},n=function(e){var n=r("api.methods."+e);return t(n,"api method "+e+" is not defined in api.methods"),n},o=r("routes"),i=function(e){var t=_.find(o,function(t){var r=new RegExp("^"+t.path+"$"),n=r.test(e);return n});return t};return{getConfig:r,getApiUrl:n,getRouteConfig:i}}),window._keypath=function(e,t){var r,n,o;if(_.isString(t)&&!_.isEmpty(e))return-1===t.indexOf(".")?e[t]||void 0:(o=e,r=t,n=t.split("."),n.forEach(function(e){o&&(o=o[e]||void 0)}),o)},angular.module("myApp.services").service("RedirectSrv",function(e){var t=function(t){e.url(t)};return{redirect:t}}),filters.filter("interpolate",["version",function(e){return function(t){return String(t).replace(/\%VERSION\%/gm,e)}}]),directives.directive("fadeIn",function(){return{compile:function(e){return $(e).css("opacity",0),function(e,t,r){$(t).animate({opacity:1},1e3)}}}}),directives.directive("stopEvent",function(){return{restrict:"A",link:function(e,t,r){t.bind(r.stopEvent,function(e){e.stopPropagation()})}}}),angular.module("myApp.main",[]).controller("mainCtrl",["$scope","$rootScope","ApiHttpSrv","ConfigSrv","$location","AuthSrv","RedirectSrv",function(e,t,r,n,o,i,a){t.plant={},i.initialState()||!i.authorized()?o.path("/login"):a.redirect("/"),t.logout=function(){i.logout()},t.changePlant=function(e){t.currentId=e,t.plant=t.plantas[e],a.redirect("/")},e.goToContracts=function(){a.redirect("/contracts")},e.goToMaquinarias=function(){a.redirect("/maquinarias")},e.goToVehiculos=function(){a.redirect("/vehiculos")},e.goToContratistas=function(){a.redirect("/contratistas")},e.goToHome=function(){a.redirect("/")},e.collapse=function(e){$("#"+e).removeClass("in"),$("#"+e).addClass("collapse")},e.goToWorkForce=function(){a.redirect("/workforce")}}]),angular.module("myApp.contract",[]).controller("contractCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","$routeParams","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c,s){var u=function(){var t={token:r.currentUser().token,id:a.id},n=function(t){e.contractData=t,console.log(t),e.loading=!1},o=function(t){console.log(t),e.loading=!1};e.loading=!0,c.createApiHttp("post",s.getApiUrl("contract"),t,t).success(n).error(o)};r.initialState()||!r.authorized()?i.redirect("/login"):u(),$("#info").tab("show"),$("#info a").click(function(e){e.preventDefault(),$(this).tab("show")}),e.goToWorkerPage=function(e){i.redirect("worker/"+t.plant.id+"/"+e)},e.goToMaquinariaPage=function(e){i.redirect("maquinaria/"+t.plant.id+"/"+e)},e.goToContratistaPage=function(e){i.redirect("contratista/"+t.plant.id+"/"+e)},e.goToVehiculoPage=function(e){i.redirect("vehiculo/"+t.plant.id+"/"+e)}}]),angular.module("myApp.contracts",[]).controller("contractsCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c){if((r.initialState()||!r.authorized())&&i.redirect("/login"),e.sortingOrder="Num",e.reverse=!1,e.filteredItems=[],e.groupedItems=[],e.itemsPerPage=10,e.pagedItems=[],e.currentPage=0,t.plant.id){console.log(t.plant);var s={token:r.currentUser().token,idPlanta:t.plant.id};e.loading=!0,a.createApiHttp("get",c.getApiUrl("contratos"),s,s).success(function(t){console.log(t),e.items=t,e.search(),e.loading=!1}).error(function(t){console.log(t),e.loading=!1})}var u=function(e,t){return t?e?-1!==e.toLowerCase().indexOf(t.toLowerCase()):void 0:!0};e.open=function(e){o.open(e,"_blank")},e.search=function(){e.filteredItems=n("filter")(e.items,function(t){for(var r in t)if(u(t[r],e.query))return!0;return!1}),""!==e.sortingOrder&&(e.filteredItems=n("orderBy")(e.filteredItems,e.sortingOrder,e.reverse)),e.currentPage=0,e.groupToPages()},e.groupToPages=function(){e.pagedItems=[];for(var t=0;t<e.filteredItems.length;t++)t%e.itemsPerPage===0?e.pagedItems[Math.floor(t/e.itemsPerPage)]=[e.filteredItems[t]]:e.pagedItems[Math.floor(t/e.itemsPerPage)].push(e.filteredItems[t])},e.range=function(e,t){var r=[];t||(t=e,e=0);for(var n=e;t>n;n++)r.push(n);return r},e.prevPage=function(){e.currentPage>0&&e.currentPage--},e.nextPage=function(){e.currentPage<e.pagedItems.length-1&&e.currentPage++},e.setPage=function(){e.currentPage=this.n},t.plant.data&&e.search(),e.goToContractPage=function(e){i.redirect("contract/"+e)},e.sort_by=function(t){e.sortingOrder==t&&(e.reverse=!e.reverse),e.sortingOrder=t}}]),angular.module("myApp.contratista",[]).controller("contratistaCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","$routeParams","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c,s){var u=function(){var t={token:r.currentUser().token,idPlanta:a.idP,id:a.idC},n=function(t){e.contratistaData=t,console.log(t),e.loading=!1},o=function(t){console.log(t),e.loading=!1};e.loading=!0,c.createApiHttp("post",s.getApiUrl("contratista"),t,t).success(n).error(o)};r.initialState()||!r.authorized()?i.redirect("/login"):u(),$("#info").tab("show"),$("#info a").click(function(e){e.preventDefault(),$(this).tab("show")}),e.goToWorkerPage=function(e){i.redirect("worker/"+t.plant.id+"/"+e)}}]),angular.module("myApp.contratistas",[]).controller("contratistasCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c){if((r.initialState()||!r.authorized())&&i.redirect("/login"),e.sortingOrder="Num",e.reverse=!1,e.filteredItems=[],e.groupedItems=[],e.itemsPerPage=10,e.pagedItems=[],e.currentPage=0,t.plant.id){console.log(t.plant);var s={token:r.currentUser().token,idPlanta:t.plant.id};e.loading=!0,a.createApiHttp("get",c.getApiUrl("contratistas"),s,s).success(function(t){console.log(t),e.items=t,e.search(),e.loading=!1}).error(function(t){console.log(t),e.loading=!1})}var u=function(e,t){return t?e?-1!==e.toLowerCase().indexOf(t.toLowerCase()):void 0:!0};e.open=function(e){o.open(e,"_blank")},e.search=function(){e.filteredItems=n("filter")(e.items,function(t){for(var r in t)if(u(t[r],e.query))return!0;return!1}),""!==e.sortingOrder&&(e.filteredItems=n("orderBy")(e.filteredItems,e.sortingOrder,e.reverse)),e.currentPage=0,e.groupToPages()},e.groupToPages=function(){e.pagedItems=[];for(var t=0;t<e.filteredItems.length;t++)t%e.itemsPerPage===0?e.pagedItems[Math.floor(t/e.itemsPerPage)]=[e.filteredItems[t]]:e.pagedItems[Math.floor(t/e.itemsPerPage)].push(e.filteredItems[t])},e.range=function(e,t){var r=[];t||(t=e,e=0);for(var n=e;t>n;n++)r.push(n);return r},e.prevPage=function(){e.currentPage>0&&e.currentPage--},e.nextPage=function(){e.currentPage<e.pagedItems.length-1&&e.currentPage++},e.setPage=function(){e.currentPage=this.n},t.plant.data&&e.search(),e.goToContratistaPage=function(e){i.redirect("contratista/"+t.plant.id+"/"+e)},e.sort_by=function(t){e.sortingOrder==t&&(e.reverse=!e.reverse),e.sortingOrder=t}}]),angular.module("myApp.home",[]).controller("homeCtrl",["$scope","$rootScope","ApiHttpSrv","ConfigSrv","$location","AuthSrv","RedirectSrv",function(e,t,r,n,o,i,a){var c=function(){var o={token:i.currentUser().token},a=function(r){console.log(r[0]),t.data=r[0],t.plantas=t.data.plantas,t.currentId||(t.currentId=0),t.plant=t.data.plantas[t.currentId],e.loading=!1},c=function(t){console.log(t),e.loading=!1,e.disconnect=!0};e.loading=!0,e.disconnect=!1,r.createApiHttp("post",n.getApiUrl("home"),o,o).success(a).error(c)};i.initialState()||!i.authorized()?o.path("/login"):c(),e.reintentar=function(){c()}}]),angular.module("myApp.login",[]).controller("loginCtrl",["$scope","ApiHttpSrv","ConfigSrv","$rootScope","AuthSrv","$location",function(e,t,r,n,o,i){o.authorized()&&!o.initialState()&&i.path("/home"),n.loginfail=!1,e.login=function(t){var r={user:e.user.name,pass:e.user.password};o.login(r)}}]),angular.module("myApp.maquinaria",[]).controller("maquinariaCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","$routeParams","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c,s){var u=function(){var t={token:r.currentUser().token,idPlanta:a.idP,id:a.idM},n=function(t){e.maquinariaData=t,console.log(t),e.loading=!1},o=function(t){console.log(t),e.loading=!1};e.loading=!0,c.createApiHttp("post",s.getApiUrl("maquinaria"),t,t).success(n).error(o)};r.initialState()||!r.authorized()?i.redirect("/login"):u(),$("#info").tab("show"),$("#info a").click(function(e){e.preventDefault(),$(this).tab("show")}),e.goToWorkerPage=function(e){i.redirect("worker/"+t.plant.id+"/"+e)}}]),angular.module("myApp.maquinarias",[]).controller("maquinariasCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c){if((r.initialState()||!r.authorized())&&i.redirect("/login"),e.sortingOrder="Num",e.reverse=!1,e.filteredItems=[],e.groupedItems=[],e.itemsPerPage=10,e.pagedItems=[],e.currentPage=0,t.plant.id){console.log(t.plant);var s={token:r.currentUser().token,idPlanta:t.plant.id};e.loading=!0,a.createApiHttp("get",c.getApiUrl("maquinarias"),s,s).success(function(t){console.log(t),e.items=t,e.search(),e.loading=!1}).error(function(t){console.log(t),e.loading=!1})}var u=function(e,t){return t?e?-1!==e.toLowerCase().indexOf(t.toLowerCase()):void 0:!0};e.open=function(e){o.open(e,"_blank")},e.search=function(){e.filteredItems=n("filter")(e.items,function(t){for(var r in t)if(u(t[r],e.query))return!0;return!1}),""!==e.sortingOrder&&(e.filteredItems=n("orderBy")(e.filteredItems,e.sortingOrder,e.reverse)),e.currentPage=0,e.groupToPages()},e.groupToPages=function(){e.pagedItems=[];for(var t=0;t<e.filteredItems.length;t++)t%e.itemsPerPage===0?e.pagedItems[Math.floor(t/e.itemsPerPage)]=[e.filteredItems[t]]:e.pagedItems[Math.floor(t/e.itemsPerPage)].push(e.filteredItems[t])},e.range=function(e,t){var r=[];t||(t=e,e=0);for(var n=e;t>n;n++)r.push(n);return r},e.prevPage=function(){e.currentPage>0&&e.currentPage--},e.nextPage=function(){e.currentPage<e.pagedItems.length-1&&e.currentPage++},e.setPage=function(){e.currentPage=this.n},t.plant.data&&e.search(),e.goToMaquinariaPage=function(e){i.redirect("maquinaria/"+t.plant.id+"/"+e)},e.sort_by=function(t){e.sortingOrder==t&&(e.reverse=!e.reverse),e.sortingOrder=t}}]),angular.module("myApp.vehiculo",[]).controller("vehiculoCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","$routeParams","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c,s){var u=function(){var t={token:r.currentUser().token,idPlanta:a.idP,id:a.idV},n=function(t){e.vehiculoData=t,console.log(t),e.loading=!1},o=function(t){console.log(t),e.loading=!1};e.loading=!0,c.createApiHttp("post",s.getApiUrl("vehiculo"),t,t).success(n).error(o)};r.initialState()||!r.authorized()?i.redirect("/login"):u(),$("#info").tab("show"),$("#info a").click(function(e){e.preventDefault(),$(this).tab("show")}),e.goToWorkerPage=function(e){i.redirect("worker/"+t.plant.id+"/"+e)}}]),angular.module("myApp.vehiculos",[]).controller("vehiculosCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c){if((r.initialState()||!r.authorized())&&i.redirect("/login"),e.sortingOrder="Num",e.reverse=!1,e.filteredItems=[],e.groupedItems=[],e.itemsPerPage=10,e.pagedItems=[],e.currentPage=0,t.plant.id){console.log(t.plant);var s={token:r.currentUser().token,idPlanta:t.plant.id};e.loading=!0,a.createApiHttp("get",c.getApiUrl("vehiculos"),s,s).success(function(t){console.log(t),e.items=t,e.search(),e.loading=!1}).error(function(t){console.log(t),e.loading=!1})}var u=function(e,t){return t?e?-1!==e.toLowerCase().indexOf(t.toLowerCase()):void 0:!0};e.open=function(e){o.open(e,"_blank")},e.search=function(){e.filteredItems=n("filter")(e.items,function(t){for(var r in t)if(u(t[r],e.query))return!0;return!1}),""!==e.sortingOrder&&(e.filteredItems=n("orderBy")(e.filteredItems,e.sortingOrder,e.reverse)),e.currentPage=0,e.groupToPages()},e.groupToPages=function(){e.pagedItems=[];for(var t=0;t<e.filteredItems.length;t++)t%e.itemsPerPage===0?e.pagedItems[Math.floor(t/e.itemsPerPage)]=[e.filteredItems[t]]:e.pagedItems[Math.floor(t/e.itemsPerPage)].push(e.filteredItems[t])},e.range=function(e,t){var r=[];t||(t=e,e=0);for(var n=e;t>n;n++)r.push(n);return r},e.prevPage=function(){e.currentPage>0&&e.currentPage--},e.nextPage=function(){e.currentPage<e.pagedItems.length-1&&e.currentPage++},e.setPage=function(){e.currentPage=this.n},t.plant.data&&e.search(),e.goToVehiculoPage=function(e){i.redirect("vehiculo/"+t.plant.id+"/"+e)},e.sort_by=function(t){e.sortingOrder==t&&(e.reverse=!e.reverse),e.sortingOrder=t}}]),angular.module("myApp.worker",[]).controller("workerCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","$routeParams","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c,s){var u=function(){var t={token:r.currentUser().token,idPlanta:a.idP,id:a.idE},n=function(t){e.workerData=t,console.log(t),e.loading=!1},o=function(t){console.log(t),e.loading=!1};e.loading=!0,c.createApiHttp("post",s.getApiUrl("worker"),t,t).success(n).error(o)};r.initialState()||!r.authorized()?i.redirect("/login"):u(),$("#info").tab("show"),$("#info a").click(function(e){e.preventDefault(),$(this).tab("show")})}]),angular.module("myApp.workforce",[]).controller("workforceCtrl",["$scope","$rootScope","AuthSrv","$filter","$window","RedirectSrv","ApiHttpSrv","ConfigSrv",function(e,t,r,n,o,i,a,c){if((r.initialState()||!r.authorized())&&i.redirect("/login"),e.sortingOrder="Ape",e.reverse=!1,e.filteredItems=[],e.groupedItems=[],e.itemsPerPage=10,e.pagedItems=[],e.currentPage=0,t.plant.id){console.log(t.plant);var s={token:r.currentUser().token,idPlanta:t.plant.id};e.loading=!0,a.createApiHttp("get",c.getApiUrl("personal"),s,s).success(function(t){console.log(t),e.items=t,e.search(),e.loading=!1}).error(function(t){console.log(t),e.loading=!1})}var u=function(e,t){return t?e?-1!==e.toLowerCase().indexOf(t.toLowerCase()):void 0:!0};e.open=function(e){o.open(e,"_blank")},e.goToWorkerPage=function(e){i.redirect("worker/"+t.plant.id+"/"+e)},e.search=function(){e.filteredItems=n("filter")(e.items,function(t){for(var r in t)if(u(t[r],e.query))return!0;return!1}),""!==e.sortingOrder&&(e.filteredItems=n("orderBy")(e.filteredItems,e.sortingOrder,e.reverse)),e.currentPage=0,e.groupToPages()},e.groupToPages=function(){e.pagedItems=[];for(var t=0;t<e.filteredItems.length;t++)t%e.itemsPerPage===0?e.pagedItems[Math.floor(t/e.itemsPerPage)]=[e.filteredItems[t]]:e.pagedItems[Math.floor(t/e.itemsPerPage)].push(e.filteredItems[t])},e.range=function(e,t){var r=[];t||(t=e,e=0);for(var n=e;t>n;n++)r.push(n);return r},e.prevPage=function(){e.currentPage>0&&e.currentPage--},e.nextPage=function(){e.currentPage<e.pagedItems.length-1&&e.currentPage++},e.setPage=function(){e.currentPage=this.n},t.plant.data&&e.search(),e.sort_by=function(t){e.sortingOrder==t&&(e.reverse=!e.reverse),e.sortingOrder=t}}]);